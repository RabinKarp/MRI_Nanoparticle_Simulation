
/*
 * This program uses the host CURAND API to generate 100
 * pseudorandom floats.
 */
#include <iostream>
#include <stdio.h>
#include <stdlib.h>
#include "cuda.h"
#include "curand.h"
#include "cuda_helpers.h"

using namespace std;

#define CUDA_CALL(x) do { if((x)!=cudaSuccess) { \
    printf("Error at %s:%d\n",__FILE__,__LINE__);\
    return EXIT_FAILURE;}} while(0)
#define CURAND_CALL(x) do { if((x)!=CURAND_STATUS_SUCCESS) { \
    printf("Error at %s:%d\n",__FILE__,__LINE__);\
    return EXIT_FAILURE;}} while(0)

int main(int argc, char *argv[])
{
    size_t n = 100;
    size_t i;
    curandGenerator_t gen;
    float *devData;

    /* Allocate n floats on host */
    cudaEvent_t start, stop;

    /* Allocate n floats on device */
    CUDA_CALL(cudaMalloc((void **)&devData, n*sizeof(float)));

    /* Create pseudo-random number generator */
    CURAND_CALL(curandCreateGenerator(&gen,
                CURAND_RNG_PSEUDO_DEFAULT));

    /* Set seed */
    CURAND_CALL(curandSetPseudoRandomGeneratorSeed(gen,
                1234ULL));

    HANDLE_ERROR(cudaEventCreate(&start));
    HANDLE_ERROR(cudaEventCreate(&stop));

    /* invoke the kernel to get some random numbers */
    HANDLE_ERROR(cudaEventRecord(start, 0));

    cout << "Starting kernel!" << endl;
    /* Generate n floats on device */
    CURAND_CALL(curandGenerateUniform(gen, devData, n));
    HANDLE_ERROR(cudaEventRecord(stop, 0));
    HANDLE_ERROR(cudaEventSynchronize(stop));

    float elapsedTime;
    HANDLE_ERROR(cudaEventElapsedTime(&elapsedTime, start, stop));

    cout << "Kernel execution complete! Elapsed time: "
      << elapsedTime << " ms" << endl;

    /* Cleanup */
    CURAND_CALL(curandDestroyGenerator(gen));
    CUDA_CALL(cudaFree(devData));
    return EXIT_SUCCESS;
}
